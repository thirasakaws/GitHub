<div id='gmap_cusgps'>
</div>
<div class="container-fluid main_data">
    <div class="box-head-title-foodmall text-center  " >
        <span class="header-foodmall">
            โปรไฟล์ของฉัน
        </span>
    </div>

        <div class="text-center">
            <img class="CUSTOMER_pictureUrl img-fluid rounded-circle img-thumbnail mx-auto d-block" width="100px" height="100px" alt="...">
           <div class="mt-3 mb-3">
             <input class="text-center h4 input_data_bn edit_data CUSTOMER_displayName font-color-foodmall header-sub-title-foodmal">

              <!-- <span class='font-color-foodmall header-sub-title-foodmall CUSTOMER_displayName editable'></span> -->
<!--             <span class='h5 text-info CUSTOMER_displayName editable'></span>  -->
             <small class="text-secondary"><i class="fas fa-pen"></i></small>
           </div>
        </div>  <!-- // Line Profile -->

        <div class="row card">
         <div class="card-body">

             <div class="form-group row">
               <label class="col-sm-4 lable-left-35 font-color-foodmall-gray-light2" >  ชื่อ  </label>
               <div class="col">
                   <input class="input_data_bn edit_data CUSTOMER_firstname w-90 " id="firstname" type="text" placeholder="ชื่อ" data-field="firstname">
               </div>
             </div>   <!-- // -->

             <div class="form-group row">
               <label class="col-sm-4 lable-left-35 font-color-foodmall-gray-light2" >  นามสกุล  </label>
               <div class="col">
                   <input class="input_data_bn edit_data CUSTOMER_lastname w-90 " id="lastname"  type="text"  placeholder="นามสกุล" data-field="lastname">
               </div>
             </div>   <!-- // -->

             <div class="form-group row">
               <label class="col-sm-4 lable-left-35 font-color-foodmall-gray-light2" >  เบอร์ติดต่อ  </label>
               <div class="col">
                   <input class="input_data_bn edit_data CUSTOMER_mobileno w-90 " id="mobileno"  type="text"  placeholder="เบอร์ติดต่อ" data-field="mobileno">
               </div>
             </div>   <!-- // -->

             <!-- <div class="form-group row d-flex">
                 <label class="col-4 font-color-foodmall-gray-light">Location</label>
                 <div class="col mr-auto text-right">

                      <small onclick='find_location_cus()' class='btn btn-sm btn-outline-submit-foodmall-small rounded-pill'>
                        <i class="fas fa-map-marker-alt"></i> GPS ระบุพิกัดของคุณ
                      </small>
                      <span id='writelocation_cus' class='badge badge-success' style='display:none'>recorded !</span>

                 </div>
             </div>  <!-- // -->

              <div class="form-group row">
                 <label class="col-4 font-color-foodmall-gray-light">ที่อยู่ปัจจุบัน</label>
                 <div class="col d-flex">
                     <div class="ml-auto">
                        <button type="button" name="button" style="border-radius: 20px;" class="btn btn-sm btn-outline-submit-foodmall-small rounded-pill"  onclick='find_location_cus()'>
                            <i class="fas fa-plus"></i> เพิ่มที่อยู่
                        </button>
                      </div>
                 </div>
             </div>  <!-- // -->
         </div>
       </div>

</div> <!-- // container-fluid  -->

<script>
    // setdatabyclass($('.main_data'), 'LINE', LINE_USER);
    refresh_cusmanage1();

    //for input tag
    $('.edit_data').Fusefield( (obj,cb,data)=>{
      console.log("data",data);
      $.postJSON('/api/liff/update/customerinfo', data, function (res) {
          if (!res.result) {
              alert(res.detail);
              cb(false);
          }else {
              res.detail ? working.customer = res.detail : false;
            cb(true);
          }
      })
    },(obj)=>{
      return true;
    });



    $('#gmap_cusgps').load('/LIFF/modal_gps.html');
      function find_location_cus() {
          var detail = {lat: 13.79607108667891, lng: 100.71164142340422};
          call_modal_maps(detail, function (data) {
              console.log('DataBack:', data);
              updategpslocation(data)
          });
      }

      function updategpslocation(loc){
        var data = {
          LINE_USER : LINE_USER,
          };
        data.location = { type: "Point", coordinates: [loc.lat, loc.lng] };

        $.postJSON('/api/liff/update/customerinfo',data,function(res){
          console.log("RES",res);
              if(!res.result){
                alert(res.detail);
                return;
              }
              working.customer.location = data.location ;
              $('#writelocation_cus').show('slow').hide('slow');
        });
      }

function refresh_cusmanage1(){
        $.postJSON('/api/liff/check/customerinfo', {LINE_USER: LINE_USER}, function (res) {
          if(res.result){
            if(res.detail){
                working.customer = res.detail;
                if(!working.customer.firstname) working.customer.firstname ='';
                if(!working.customer.lastname) working.customer.lastname ='';
                if(!working.customer.mobileno) working.customer.mobileno ='';
                  setdatabyclass($('.main_data'), 'CUSTOMER', working.customer);
                // return;
            }
            // $('#customerdetail').html(JSON.stringify(res.detail));

          }else{
            alert(res.detail);
          }
        });
        $.postJSON('/api/liff/get/address', {LINE_USER: LINE_USER}, function (res) {
          if(res.result){


          }else{
            alert(res.detail);
          }
        });

};

var showadd_address_temp=false;
function showadd_address(){
  if(showadd_address_temp){
    $('.showadd_address').hide();
  }else{
      $('.showadd_address').show();
  }
  showadd_address_temp = !showadd_address_temp;
}


  </script>
