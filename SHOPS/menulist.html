<style>
.margin-top-under-navbar { margin-top: 55px;}    
.btn-push {
    z-index: 20;
    position: absolute;
    right: 10px;
    bottom: 91.5px;   /* -21.5px;   */
} 

.button-circle {
    position: relative;  /* relative */
}
.wrapper-button-circle {
    top: 5px;
    left: 12px;
    border-radius: 100%;
    position: absolute;
    width: 35px;
    height: 35px;
    background: red;  /*#00bd29 */
}
    
.btn-add-to-cart {     
    border: 4px #fff solid;
    border-radius: 25px;
    background: #fff; 
    font-size: 2.9em;
}
</style>
<div class="fixed-top" id='top_shopping_cart'  style="display:none">

 <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top ">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon font-color-foodmall"></span>
    </button>

    <a class="navbar-brand" href="#">
        <button onclick="go2View('cart')" class="border border-0">
           <span class="badge badge-pill badge-warning ">##CART-totalitem##</span> <i class="fas fa-shopping-basket font-color-foodmall"></i>
        </button>
    </a>



  <div class="collapse navbar-collapse " id="navbarTogglerDemo03">
    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
<!--      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
      </li>-->
    </ul>
    <form class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
  </div>
</nav>



<!--  TOP MENU
  <button onclick="go2View('cart')">
##CART-totalitem## ในตระกร้า
</button>-->
</div> <!-- topmenu -->
 

<!-- Slide -->
<div id="carouselExampleIndicators" class="carousel slide margin-top-under-navbar" data-ride="carousel" >
  <ol class="carousel-indicators">
    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
  </ol>

  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="https://img.freepik.com/free-photo/vegetarian-vietnamese-spring-rolls-with-spicy-shrimps-prawns-carrot-cucumber-red-cabbage-rice-noodle_2829-18322.jpg?size=626&ext=jpg" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item">
      <img src="https://img.freepik.com/free-photo/vegetarian-vietnamese-spring-rolls-with-spicy-shrimps-prawns-carrot-cucumber-red-cabbage-rice-noodle_2829-18324.jpg?size=626&ext=jpg" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item">
      <img src="https://img.freepik.com/free-photo/vegetarian-vietnamese-spring-rolls-with-spicy-shrimps-prawns-carrot-cucumber-red-cabbage-rice-noodle_2829-18343.jpg?size=626&ext=jpg" class="d-block w-100" alt="...">
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
<!-- // Slide การตลาดกำหนดขนาดมา-->


<!-- Category -->

<div class="mt-5 mb-5">
    Category Slide ค้างไว้ก่อนค่อยมาทำต่อ
</div>
<!-- // Category -->


<div class="row" id='mainview' style="padding: 10px;">
  Loading..
</div>



<div class="row " id='template_mainview' style="display:none; ">
    <div class="card-deck col-lg-3 col-sm-3 col-md-3 col-6 mb-3" id='main_menu_preview' >
        <div class="card border border-0 shadow-sm rounded-lg">
          <img src="https://www.kinarai.com/cdn/image/menu/##menu-mainimage##" class="card-img-top" alt="...">
         
         
          
          <div class="card-body pt-2">
              <h6 class="card-title text-left mt-2" style="height:40px;">##menu-name## </h6>
<!--                <p class="card-text font-color-foodmall-gray-light2">รายละเอียด</p>-->
<!--                <p class="card-text">##menu-description##</p>-->
            <div class="btn-push" onclick="addtocart(##menu-id##)">
              <div class="button-circle">
                 <i class="fas fa-plus-circle fa-3x btn-add-to-cart font-color-foodmall"></i>
              </div>
          </div>
            <div class="row p-0">
                <div class="col-5 ">
                    1 ชุด
                </div>
                 <div class="col-7 text-right">
                    <span class="" >฿ ##menu-mainprice##</span>
                </div>
            </div>  <!-- // -->
            
             
          </div>  <!-- // cardbody -->
          

<!--                <div> Review of Customer </div>
            ...
            <br>-->
        </div>   <!-- // card --> 

    </div> <!-- // card deck --> 
</div> <!-- // row --> 
  



<div class="modal fade " id="modal_priceselect" tabindex="-1" role="dialog"  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
    <div class="form-group row mt-3 ">
        <div id='menuprice-select' class="pl-3 alert alert-warning" style="width:100%">
             <label for="inputEmail3" class="col-sm-2 col-form-label"> เลือกรายการ </label>
             <div class="col-sm-9">
                 <select class="" id='menu_select'></select>


             </div>
         </div>
    </div>

    <div class="modal-footer">

        <button onclick="updateselectprice()" class="btn btn-sm btn-orange"><i class="fa fa-fw fa-save"></i> OK </button>
        <button onclick="$('#modal_priceselect').modal('hide');" class="btn btn-sm btn-light border border-secondary"><i class="fa fa-fw fa-times"></i> Close </button>
    </div>

    </div>
    </div>
</div>

<script>

  var detail = window.location.search.replace('?liff.state=%2FLINE%2Fmenuview%3F','');
  var working={};
  var template = $('#template_mainview').html();
  var template_cart = $('#top_shopping_cart').html();
  $('#top_shopping_cart').html('').show();
  //$('#main_menu_preview').html('').show();

  function addtocart(menuid){

    var data2send ={
      LINE_USER: LINE_USER,
      menuid:menuid,
      selectedprice:working.selectedprice,
      main:main_web_site,
      action:'add'
      }
    $.postJSON('/engine/order',data2send,(res)=>{
      //  alert("Add to Shopping Cart");
        if(res.result){
          if(res.action =='selectprice'){ // Show Select Price
            working.menuid = menuid;
            $('#modal_priceselect').modal('show');
            working.selectprice = res.detail.prices;
            set_selection(res.detail.prices);
            return;
          }else{
            working.order = res.detail;
            update_shoppingcart();
          }
        }else{
            alert(res.detail);
        }

    });
  }
  function set_selection (allprice){
      var html ='';
      for(var x=0; x < allprice.length;x++){
        html += `<option value="${x}">${allprice[x].detail} ราคา ${allprice[x].price} บาท </option>`;
      }
          $('#menu_select').html(html);
    }


  function runApp() {

      $.postJSON('/engine/order',{LINE_USER: LINE_USER,action:'getdetail'},(res)=>{
          if(res.result){
            working.order = res.detail;



          //alert("Found item" +  res.detail.items.length)

            // $('#shopingcart').html(JSON.stringify(res.detail));
          }else{

          }
          update_shoppingcart();
          //return false;
          $.postJSON('/engine/get/menulist',{LINE_USER: LINE_USER,menuid:undefined},(res)=>{

                if(res && res.detail){

                var menu = res.detail;
                var allhtml ='';
                res.detail.map( (each)=>{
                    each.images ?  each.mainimage = each.images[0] : each.mainimage= 'kinarai.png';
                    each.price ?  each.mainprice = each.price[0].price : each.mainprice = '-';
                });
                allhtml=hash_replace(template,'menu',res.detail);
                // alert(allhtml);
                // return;
                $('#mainview').html(allhtml);
              } else{
                alert(res.detail);
              }
          });
      });


  }
  function update_shoppingcart(){
      if(working.order && working.order.items){
          working.order.totalitem =0;
          working.order.items.map((obj)=>{
              working.order.totalitem +=obj.qty;
          })
      }
      $("#top_shopping_cart").html(hash_replace(template_cart,'CART',working.order))
  }
  initializeLiff();
  function updateselectprice(){
      var index = $('#menu_select').val();

      $('#modal_priceselect').modal('hide');
      working.selectedprice = working.selectprice[index];
    //  alert("INDEX:" + JSON.stringify(working.selectedprice));
      addtocart(working.menuid);
  }

</script>
