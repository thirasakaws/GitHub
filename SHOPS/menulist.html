<link href="https://www.alakrbb.com/dist/common.425698d7a0766f1a48bc.css">
<style>
.font-color-foodmall {  color: #8AA43A !important; }
.margin-top-under-navbar { margin-top: 49px;}
.bg-master-foodmall { background-color: #8AA43A; }
.items-add-to-cart { right: 18%;  position: absolute; top: 25%; }
.border-bottom-color-primary  { border-bottom :3px solid #8AA43A !important; } /* เขียว */
.border-success-foodmall { border-color :#8AA43A !important; }
/* ข้างบนนำขึ้น Server */


.btn-push {
    z-index: 20;
    position: absolute;
    right: 0px;
  /*  bottom: 91.5px;   // -21.5px; */
    padding-bottom: 10px;

}

.button-circle {
    position: relative;  /* relative */
}
.wrapper-button-circle {
    top: 5px;
    left: 12px;
    border-radius: 100%;
    position: absolute;
    width: 35px;
    height: 35px;
    background: red;  /*#00bd29 */
}

/*.btn-add-to-cart {
    border: 4px #fff solid;
    border-radius: 25px;
    background: #fff;
    font-size: 2.5em;
}*/
/*  #8AA43A  */

</style>
 <!-- Link Swiper's CSS -->


<div class="fixed-top shadow" id='top_shopping_cart'  > <!-- // style="display:none"  -->
    <div class="row box-head-title-foodmall fixed-top shadow" style="background-color: #F6F6F6 !important;">
        <div class="col-3 p-0 pl-1 text-left">
            <button class='btn border border-0 text-secondary' onclick="window.history.back();">
                <i class="fas fa-chevron-left"></i> Back
            </button>
        </div>
        <div class="col-6 p-0 text-center">
            <div class="header-foodmall font-color-foodmall-gray-medium mt-1"> สั่งอาหาร</div>
        </div>
        <div class="col-3 text-right">
            <div class="d-block mr-4" onclick="go2View('cart')">
                <img src="/image/icons8-shopping-cart-80.png" class="float-right" alt="" style="width: 52%; max-width:45px;"/>
            </div>
            <div class="items-add-to-cart badge badge-pill badge-danger">##CART-totalitem##</div>
        </div>
    </div> <!--// menu -->

</div> <!-- topmenu แสดงทุกหน้าหัวข้อเปลี่ยนเป็นของแต่ละหน้า -->



<!-- Slide banner  -->

<div id="carouselExampleIndicators" class="carousel slide margin-top-under-navbar" data-ride="carousel" >
<!--  <ol class="carousel-indicators">
    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
  </ol> ไม่แสดงให้กดซ้ายขวา แทน -->

  <div class="carousel-inner">
    <div class="carousel-item  active">
      <img src="https://img.freepik.com/free-photo/vegetarian-vietnamese-spring-rolls-with-spicy-shrimps-prawns-carrot-cucumber-red-cabbage-rice-noodle_2829-18322.jpg?size=626&ext=jpg" class="d-block w-100 img-fluid" alt="...">
    </div>
    <div class="carousel-item">
      <img src="https://img.freepik.com/free-photo/vegetarian-vietnamese-spring-rolls-with-spicy-shrimps-prawns-carrot-cucumber-red-cabbage-rice-noodle_2829-18324.jpg?size=626&ext=jpg" class="d-block w-100 img-fluid" alt="...">
    </div>
    <div class="carousel-item">
      <img src="https://img.freepik.com/free-photo/vegetarian-vietnamese-spring-rolls-with-spicy-shrimps-prawns-carrot-cucumber-red-cabbage-rice-noodle_2829-18343.jpg?size=626&ext=jpg" class="d-block w-100 img-fluid" alt="...">
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>

<!-- // Slide banner การตลาดกำหนดขนาดมา-->


<div class="container-fluid text-center mx-auto" style="position: absolute; width: 100%; z-index: 16;  top: 36%;">
    <img src="/image/logo-ohkajhu.png" class="img-fluid rounded-circle shadow" alt="" style="width:25%; border: 5px #ffffff solid; background-color: #fff;"/>
</div> <!-- // logo website -->




<!-- Category -->


<div class="container-fluid">
    <div class="row mt-5 mb-5">
        <div class="col-10 ">

            <iframe src="https://swiperjs.com/demos/110-slides-per-view.html"  style="width:100%" frameborder="0" ></iframe>
            <!-- ตัวอย่าง https://swiperjs.com/demos/ -->
            <!-- Slider for mobile  https://nickpiscitelli.github.io/Glider.js/index.html#demos  -->

            <div class="row">
                <div class="col border border-success-foodmall text-center rounded m-1 p-2">
                    <span class="font-color-foodmall">ประเภท</span>
                </div>
                <div class="col border border-success-foodmall text-center rounded m-1 p-2">
                    <span class="font-color-foodmall">ประเภท</span>
                </div>
                <div class="col border border-success-foodmall text-center rounded m-1 p-2">
                    <span class="font-color-foodmall">ประเภท</span>
                </div>
                <div class="col border border-success-foodmall text-center rounded m-1 p-2">
                    <span class="font-color-foodmall">ประเภท</span>
                </div>
            </div>
        </div> <!-- category -->

        <div class="col-2 pl-1  text-center">

            <div class="btn  mt-1 p-1" onclick="openSearch()" style="background-color: #f3f3f3;">
                <img src="/image/icons8-search.svg" style="width:83%;">
            </div>
        </div>
    </div>
</div>




<div class="row" id='mainview' style="padding: 10px;">
  Loading..
</div>



<div class="row " id='template_mainview' style="display:none; ">
    <div class="card-deck col-lg-3 col-sm-3 col-md-3 col-6 mb-3" id='main_menu_preview' >
        <div class="card border border-0 shadow-sm rounded-lg border-bottom-color-primary" >
          <img src="https://www.kinarai.com/cdn/image/menu/##menu-mainimage##" class="card-img-top" alt="...">



          <div class="card-body pt-2 pb-1">
              <h6 class="card-title text-center mt-2" style="height:40px;">##menu-name## </h6>

<!--                <p class="card-text font-color-foodmall-gray-light2">รายละเอียด</p>-->
<!--                <p class="card-text">##menu-description##</p>-->

            <div class="row p-0">
                <div class="col-8 pl-1">
                    <div class="font-color-foodmall-gray-medium mt-3 font-weight-bold" >
                   ##menu-promotionprice##      ฿ ##menu-mainprice##
                    </div>
                </div>

                <div class="col-4 text-right">
                     <div class="d-block">
                         <i class="fas fa-plus-circle fa-2x font-color-foodmall" ##menu-disable## onclick="addtocart(##menu-id##)"></i>
                     </div>
                     <!--<img src="/image/icons8-plus-green.svg" onclick="addtocart(##menu-id##)" style="width:153%">-->
                </div>
            </div>  <!-- // -->

          </div>  <!-- // cardbody -->


<!--                <div> Review of Customer </div>
            ...
            <br>-->
        </div>   <!-- // card -->

    </div> <!-- // card deck -->
</div> <!-- // row -->




<div class="modal fade " id="modal_priceselect" tabindex="-1" role="dialog"  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
    <div class="form-group row mt-3 ">
      <div id='menuprice-select' class="" style="width:100%">
           <span class="font-color-foodmall pl-1"> เลือกรายการ </span>
           <div class="form-group row pb-2">

               <div class="col-10 pr-0" id="add_item_selectprice" style="display:none">
                    กรุณาเลือกราคา
                    <select class="form-control ml-1" id='menu_select' ></select>
               </div>
               <div class="col-10 pr-0"  id="add_item_selectoption" style="display:none">
                    ตัวเลือก
                    <select class="form-control ml-1" id='menu_option' placeholder="เลือกรายการ" ></select>
               </div>

           </div>

       </div>
    </div>

    <div class="modal-footer">

      <button onclick='update_price()' class=' btn btn-md btn-submit-foodmall rounded-circle' id='managebranch'>
         <i class="fas fa-plus"></i>
      </button>
        <button onclick="$('#modal_priceselect').modal('hide');" class="btn btn-sm btn-light border border-secondary"><i class="fa fa-fw fa-times"></i> Close </button>
    </div>

    </div>
    </div>
</div>






<script>

  var detail = window.location.search.replace('?liff.state=%2FLINE%2Fmenuview%3F','');
  var working={};
  var template = $('#template_mainview').html();
  var template_cart = $('#top_shopping_cart').html();
  $('#top_shopping_cart').html('').show();
  //$('#main_menu_preview').html('').show();

  function addtocart(menuid,cb){

    var data2send ={
      LINE_USER: LINE_USER,
      menuid:menuid,
      selectedprice:working.selectedprice,
      main:main_web_site,
      selectedoption:working.selectedoption,
      action:'add'
      }
    $.postJSON('/engine/order',data2send,(res)=>{
      //  alert("Add to Shopping Cart");
        if(res.result){
          if(res.action =='selectprice'){ // Show Select Price
            $('.select_price').show();
              working.menuid = menuid;
            if(res.detail.prices.length > 1){
              working.selectprice = res.detail.prices;
              set_selection(res.detail.prices);

            }
            if(res.detail.option && res.detail.option.length > 0){
                set_select_option(res.detail);
            }
            $('#modal_priceselect').modal('show');

            return;
          }else{
            working.order = res.detail;
            update_shoppingcart();
          }
          working.selectedprice = undefined;
          working.selectedoption =undefined;
          if(cb) cb(true);
        }else{
            alert(res.detail);
        }

    });
  }
  function set_selection (allprice){
      var html ='';
      for(var x=0; x < allprice.length;x++){
        html += `<option value="${x}">${allprice[x].detail} ราคา ${allprice[x].price} บาท </option>`;
      }
          $('#menu_select').html(html);
          $('#add_item_selectprice').show();
    }
    function set_select_option(objdetail){

      if(!(Number(objdetail.optionlimit) > 0) ){
        objdetail.optionlimit =1;
      }

      var seldata = `<option disabled selected>เลือกรายการ ${objdetail.optionlimit} รายการ </option>`;
        if(objdetail.optionlimit > 1){
          seldata = `<option disabled>เลือกรายการ ${objdetail.optionlimit} รายการ </option>`;
           $('#menu_option').attr(  "multiple","multiple" );
      //    seldata = `<option value='' disabled selected>--เลือกรายการ--</option>`;
        }
         if(Array.isArray(objdetail.option)){
           for (var x = 0; x < objdetail.option.length; x++) {
               seldata += '<option value="' +objdetail.option[x] + '"  >' + objdetail.option[x] + '</option>';
           }
         }
         //$('#menu_option').select2('destroy');
         $('#menu_option').off('change.select2');
         $('#menu_option').html(seldata);
         $('#add_item_selectoption').show();
         if(objdetail.optionlimit ==1) return;  // not Select2
         var select2option = {
             tags: false,
             tokenSeparators: [',', ' '],
             allowClear: true,
             maximumSelectionLength: objdetail.optionlimit
         }
        $('#menu_option').select2(select2option);

    }
    function update_price(){
        var index = $('#menu_select').val();
      //


        if(working.selectprice){
            working.selectedprice = working.selectprice[index];
        }
        working.selectedoption = $('#menu_option').val();
        addtocart(working.menuid,(re)=>{
          if(re){
            $('#modal_priceselect').modal('hide');
          }
        });

    }
  function runApp() {

      $.postJSON('/engine/order',{LINE_USER: LINE_USER,action:'getdetail'},(res)=>{
          if(res.result){
            working.order = res.detail;
          //alert("Found item" +  res.detail.items.length)

            // $('#shopingcart').html(JSON.stringify(res.detail));
          }else{

          }

          update_shoppingcart();
          //return false;
          $.postJSON('/engine/get/menulist',{LINE_USER: LINE_USER,menuid:undefined},(res)=>{
                if(res && res.detail){

                var menu = res.detail;
                var allhtml ='';
                res.detail.map( (each)=>{
                    each.images ?  each.mainimage = each.images[0] : each.mainimage= 'kinarai.png';
                    each.price ?  each.mainprice = each.price[0].price : each.mainprice = '-';
                    each.normal_price ? each.promotionprice = "<strike>฿ " + each.normal_price + "</strike>" : each.promotionprice = '';
                    if(each.status !=1){
                      each.disable = "disabled='disabled'"
                    }
                    
                });
                allhtml=hash_replace(template,'menu',res.detail);
                // alert(allhtml);
                // return;
                $('#mainview').html(allhtml);
              } else{
                alert(res.detail);
              }
          });
      });


  }
  function update_shoppingcart(){
      if(working.order && working.order.items){
          working.order.totalitem =0;
          working.order.items.map((obj)=>{
              working.order.totalitem +=obj.qty;
          })
      }
      $("#top_shopping_cart").html(hash_replace(template_cart,'CART',working.order))
  }
  initializeLiff('menulist');


</script>
