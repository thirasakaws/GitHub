
<div style="border:solid 1px ;margin: 2%;border-radius:10px;padding:20px" class="main_data">
    <div class="row">

        
        <div class="col-12 col-sm-12 col-md-8">
            <h1 class="text-header_page"><b><u>Edit  Shop Branch</u></b></h1>
        </div>
        <div class="col-12 col-sm-12 col-md-4 text-right"  >
            <div>
                <button class="btn btn-outline-primary alink" onclick='go2View("/shop_branch_list")'>
                    <i class="fa fa-arrow-left"></i>
                    Back
                </button>
                <button class="btn btn-outline-success alink" onclick="return submit_add_data()">
                    <i class="fa fa-save"></i>
                    Save
                </button>
            </div>
        </div>
    </div>

    <br>
    <div class="row" id="setdata_shop_branch">
        <div class="col-lg-12 col-md-12 p-4">
                <div class="form-row p-2">
                    
                    <div class="col-12 col-md-4 col-sm-4 col-lg-4 text-left  pr-3">
                        <h3>ชื่อ สาขา</h3>
                    </div>
                    <div class="col-12 col-md-8 col-sm-8 col-lg-8">
                        <input type="text"  name="search" class=" shop_branch_name form-control input-sm autoFilter" placeholder="ชื่อ"  >
                    </div>

                </div>
            <div class="form-row p-2">
                    <div class="col-12 col-md-4 col-sm-4 col-lg-4 text-left  pr-3">
                        <h3>ร้าน</h3>
                    </div>
                    <div class="col-12 col-md-8 col-sm-8 col-lg-8">
                        <select   name="search" class="shop_branch_shopid form-control input-sm autoFilter"  id="select_shop"></select>
                    </div>
            </div>
            <div class="form-row p-2">
                    <div class="col-12 col-md-4 col-sm-4 col-lg-4 text-left pr-3">
                        <h3>ที่อยู่</h3>
                    </div>
                    <div class="col-12 col-md-8 col-sm-8 col-lg-8">
                        <input type="text"  name="search" class=" shop_branch_address form-control input-sm autoFilter" placeholder="ที่อยู่"  >
                    </div>
            </div>
            <div class="form-row p-2">
                    <div class="col-12 col-md-4 col-sm-4 col-lg-4 text-left pr-3">
                        <h3>จังหวัด</h3>
                    </div>
                    <div class="col-12 col-md-8 col-sm-8 col-lg-8">
                        <select  id="shop_province" class="shop_branch_province form-control input-sm autoFilter"  >

                         </select>
                    </div>

            </div>
            <div class="form-row p-2">
                    <div class="col-12 col-md-4 col-sm-4 col-lg-4 text-left pr-3">
                        <h3>เบอร์ติดต่อ</h3>
                    </div>
                    <div class="col-12 col-md-8 col-sm-8 col-lg-8">
                        <input type="text"  name="search" class=" shop_branch_contact form-control input-sm autoFilter" placeholder="เบอร์ติดต่อ"  >
                    </div>

            </div>


            
<div class=" mb-2" id="date-list">
                        <div class="row   pt-2 m-0  text-right">
                            <div class="col-3 text-left text-gray-light ">
                              <h3>วันอาทิตย์</h3>
                            </div>
                            <div class="col-6">
                                <div class="row text-center mb-2">
                                   <div class="col-6">
                                     เวลาเปิด
                                       <select id="opentime_sun" class="form-control timmmer_" name="" onchange="manage_opendate('sun','open',this);">

                                       </select>
                                   </div>
                                   <div class="col-6">
                                     เวลาปิด
                                       <select id="closetime_sun" class="form-control timmmer_" name="" onchange="manage_opendate('sun','close',this);">

                                       </select>
                                   </div>

                                </div>
                            </div>
                            <div class="col-3">
                                <label class="switch" >
                                    <input type="checkbox" id="date_sun" class="toggle-date" onchange="manage_opendate('sun','action',this);" style="width:50px;">

                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>


                        <div class="row   pt-2 m-0  text-right">
                            <div class="col-3 text-left text-gray-light ">
                              <h3>วันจันทร์</h3>
                              </div>
                              <div class="col-6">
                                <div class="row text-center mb-2">
                                   <div class="col-6">
                                     เวลาเปิด
                                       <select id="opentime_mon" class="form-control timmmer_" name="" onchange="manage_opendate('mon','open',this);">

                                       </select>
                                   </div>
                                   <div class="col-6">
                                     เวลาปิด
                                       <select id="closetime_mon" class="form-control timmmer_" name="" onchange="manage_opendate('mon','close',this);">

                                       </select>
                                   </div>

                                </div>
                              </div>
                            <div class="col-3">
                                <label class="switch">
                                    <input type="checkbox" id="date_mon" class="toggle-date" onchange="manage_opendate('mon','action',this);">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                        <div class="row   pt-2 m-0  text-right">
                            <div class="col-3 text-left text-gray-light ">
                              <h3>วันอังคาร</h3>
                            </div>
                            <div class="col-6">
                                <div class="row text-center mb-2">
                                   <div class="col-6">
                                     เวลาเปิด
                                       <select id="opentime_tue" class="form-control timmmer_" name="" onchange="manage_opendate('tue','open',this);">

                                       </select>
                                   </div>
                                   <div class="col-6">
                                     เวลาปิด
                                       <select id="closetime_tue" class="form-control timmmer_" name="" onchange="manage_opendate('tue','close',this);">

                                       </select>
                                   </div>

                                </div>
                            </div>
                            <div class="col-3">
                                <label class="switch">
                                    <input type="checkbox" id="date_tue" class="toggle-date" onchange="manage_opendate('tue','action',this);">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                        <div class="row   pt-2 m-0  text-right">
                            <div class="col-3 text-left text-gray-light ">
                              <h3>วันพุธ</h3>
                              </div>
                              <div class="col-6">
                                <div class="row text-center mb-2">
                                   <div class="col-6">
                                     เวลาเปิด
                                       <select id="opentime_wed" class="form-control timmmer_" name="" onchange="manage_opendate('wed','open',this);">

                                       </select>
                                   </div>
                                   <div class="col-6">
                                     เวลาปิด
                                       <select id="closetime_wed" class="form-control timmmer_" name="" onchange="manage_opendate('wed','close',this);">

                                       </select>
                                   </div>

                                </div>
                            </div>
                            <div class="col-3">
                                <label class="switch">
                                    <input type="checkbox" id="date_wed" class="toggle-date" onchange="manage_opendate('wed','action',this);">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                        <div class="row   pt-2 m-0  text-right">
                            <div class="col-3 text-left text-gray-light ">
                              <h3>วันพฤหัสบดี</h3>
                              </div>
                              <div class="col-6">
                                <div class="row text-center mb-2">
                                   <div class="col-6">
                                     เวลาเปิด
                                       <select id="opentime_thu" class="form-control timmmer_" name="" onchange="manage_opendate('thu','open',this);">

                                       </select>
                                   </div>
                                   <div class="col-6">
                                     เวลาปิด
                                       <select id="closetime_thu" class="form-control timmmer_" name="" onchange="manage_opendate('thu','close',this);">

                                       </select>
                                   </div>

                                </div>
                            </div>
                            <div class="col-3">
                                <label class="switch">
                                    <input type="checkbox" id="date_thu" class="toggle-date" onchange="manage_opendate('thu','action',this);">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                        <div class="row   pt-2 m-0  text-right">
                            <div class="col-3 text-left text-gray-light ">
                              <h3>วันศุกร์</h3>
                              </div>
                              <div class="col-6">
                                <div class="row text-center mb-2">
                                   <div class="col-6">
                                     เวลาเปิด
                                       <select id="opentime_fri" class="form-control timmmer_" name="" onchange="manage_opendate('fri','open',this);">

                                       </select>
                                   </div>
                                   <div class="col-6">
                                     เวลาปิด
                                       <select id="closetime_fri" class="form-control timmmer_" name="" onchange="manage_opendate('fri','close',this);">

                                       </select>
                                   </div>

                                </div>
                            </div>
                            <div class="col-3">
                                <label class="switch">
                                    <input type="checkbox" id="date_fri" class="toggle-date" onchange="manage_opendate('fri','action',this);">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                        <div class="row   pt-2 m-0  text-right">
                            <div class="col-3 text-left text-gray-light ">
                              <h3>วันเสาร์</h3>
                              </div>
                              <div class="col-6">
                                <div class="row text-center mb-2">
                                   <div class="col-6">
                                     เวลาเปิด
                                       <select id="opentime_sat" class="form-control timmmer_" name="" onchange="manage_opendate('sat','open',this);">

                                       </select>
                                   </div>
                                   <div class="col-6">
                                     เวลาปิด
                                       <select id="closetime_sat" class="form-control timmmer_" name="" onchange="manage_opendate('sat','close',this);">

                                       </select>
                                   </div>

                                </div>
                            </div>
                            <div class="col-3">
                                <label class="switch">
                                    <input type="checkbox" id="date_sat" class="toggle-date" onchange="manage_opendate('sat','action',this);">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                    </div>
            <div class="row">
                        <h3 class="col-sm-6 col-lg-6 text-gray-light " style="width:auto;"> สถานะ การเปิดใช้งาน<span class="text-gray-light2">(ปิด-เปิด)</span> </h3>
        <div class="col text-right d-flex d-inline ">
            <div class="ml-auto">
                <label class="switch">
                    <input type="checkbox" id="status_branch" onchange="change_status_branch(this)">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
            </div>
        </div>
            <div class="row p-4">
        <h3 class="col-sm-4 col-12 col-lg-4  " >Location</h3>
        <div class="col-sm-8 col-12 col-lg-8">
            <div class="float-left pl-2  w-100 text-right">
                <button onclick='show_gps()' class='btn btn-md btn-outline-success'>
                    <i class="fas fa-map-marker-alt"></i> GPS ระบุพิกัดร้านอาหาร
                </button>
                <span id='writelocationok' class='badge badge-success' style='display:none'>recorded !</span>

            </div>
        </div>
    </div> <!-- // GPS -->
    <div class="row p-4">
        <h3 class="col-sm-4 col-12 col-lg-4 " > Config Area Service </h3>
        <div class="col-sm-8 col-12 col-lg-8">
            <div class="float-left pl-2  w-100 text-right">
                <button onclick='show_gps_raduis()' class='btn btn-sm btn-outline-success'>
                    <i class="fas fa-map-marker-alt"></i> ตั้งค่า พื้นที่ให้บริการ
                </button>
                <span id='writelocationok_radius' class='badge badge-success' style='display:none'>recorded !</span>

            </div>
        </div>
    </div> <!-- // GPS raduis-->
    </div>

</div>
                <div id='gmap_gps'>
                </div>
<div class="modal fade" id="showmodal" tabindex="-1" role="dialog" aria-labelledby="modalshopstatus" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalshopstatus">Location Branch | ID :<span id="id_shop"></span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

            </div>

            <div class="modal-footer">
 <button onclick="btn_modal_map_current()" class="btn btn-sm btn-danger"><i class="fas fa-map-marker-alt"></i> ไปตำแหน่งปัจจุบัน</button>
            <button onclick="btn_modal_map()" class="btn btn-sm btn-submit-shop btn-submit-foodmall"><i class="fa fa-fw fa-save"></i> บันทึกที่อยู่นี้ </button>
            <button onclick="close_map();" class="btn btn-sm btn-light border border-secondary"><i class="fa fa-fw fa-times"></i> Close </button>
            </div>
        </div>
    </div>
</div>
<link rel="stylesheet" href="/css/croppie.css" />
<script src="/js/croppie.js"></script>

<div class="demo"></div>


<div style="max-width:350px;max-height: 350px;border: solid 1px"><img id="dddd" class="my-image" src="/image/Kinarai.jpg" />

</div>
    <div>
        
<button class="vanilla-rotate" data-deg="-90">Rotate Left</button>
<button class="vanilla-rotate" data-deg="90">Rotate Right</button>

        <button class="btn-md btn-primary" onclick="get_image()">Get Image</button>
    </div>
<script>


////CropImage.init()
var el = document.getElementById('dddd');
var resize = new Croppie(el, {
    viewport: { width: 250, height: 250 },
    boundary: { width: 300, height: 300 },
    
//    showZoomer: false,
//    enableResize: true,
    enableOrientation: true,
//    mouseWheelZoom: 'ctrl'
});
resize.bind({
    url: '/image/Kinarai.jpg',
//    points: []
});

//
$('.vanilla-rotate').on('click', function(ev) {
 resize.rotate(parseInt($(this).data('deg')));
});
////on button click
//function get_image(){
//    resize.result('base64','viewport').then(function(blob) {
//        // do something with cropped blob
//        $('.demo').html(blob)
//    });
//}


    var time = ['00:00','00:30','01:00','01:30','02:00','02:30','03:00','03:30','04:00','04:30','05:00','05:30','06:00','06:30','07:00','07:30','08:00','08:30','09:00','09:30','10:00','10:30','11:00','11:30','12:00',
  '13:00','13:30','14:00','14:30','15:00','15:30','16:00','16:30','17:00','17:30','18:00','18:30','19:00','19:30','20:00','20:30','21:00','21:30','22:00','22:30','23:00','23:30'];

  var optiondata = '';
  // optiondata += '<option value="" disabled selected>โปรดระบุ</option>';
     if(time.length>0){
           for(var x=0;x<time.length;x++){
                optiondata += '<option value="' +time[x] + '">' + time[x] + '</option>';
           }
         }
         $('.timmmer_').html(optiondata);
  

    var shop_branch_id = getParameterByName('shop_branch_id');
    var tempbranch
    $.postJSON('/api/data/kinarai/shop_list', {},function (data1) {
             console.log(data1)
            create_select('select_shop', data1.obj, 'name')
                    $.get('/api/data/ticket/province_list',function(data){

                    var selectoption =""
                    selectoption += '<option value="">----เลือก-----</option>'
                    for(var x=0;x<data.length;x++){
                        selectoption +='<option value="'+data[x]._id+'">'+data[x].name+'</option>'
                    }
                    $('#shop_province').html(selectoption)
                                
                                //load shopdata
                    $.get('/api/data/kinarai/shop_branch_edit/' + shop_branch_id, function (result) {
                        console.log(result)
                        tempbranch =result
                        var objjquery = $('#setdata_shop_branch');
                         setdatabyclass(objjquery, 'shop_branch', result);
                    });
           })
    });


$('#gmap_gps').load('/adminkinarai/modal_gps_full.html');
    // $('#gmap_gps_raduis').load('/LIFF/modal_map_radius.html');
    function show_gps() {
        var pos;
        if (tempbranch.location && Array.isArray(tempbranch.location.coordinates)) {
            // Already input Location
            pos = {lat: tempbranch.location.coordinates[0], lng: tempbranch.location.coordinates[1],user_type:"seller"};
            call_modal_maps(pos, updategpslocation, showError);
        } else {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    console.log("GOT POSTIION", position);
                    // if(!position.coords.latitude && !position.coords.longitude){
                    pos = {}
                    // }else {
                    //   pos = {lat: position.coords.latitude, lng: position.coords.longitude};
                    // }

                    // pos = {lat: position.coords.latitude, lng: position.coords.longitude};
                    call_modal_maps(pos, updategpslocation, showError);
                });
                return;
            }
        }
//$('#showmodal').modal('show')


    }
    
    
    function show_gps_raduis() {
        go2View('map_area');
        // var pos;
        // if (tempbranch.location && Array.isArray(tempbranch.location.coordinates)) {
        //     // Already input Location
        //     pos = {lat: tempbranch.location.coordinates[0], lng: tempbranch.location.coordinates[1],service_radius:tempbranch.location.service_radius}
        //     call_modal_radius_maps(pos, updategpslocation_radius, showError);
        // } else {
        //     if (navigator.geolocation) {
        //         navigator.geolocation.getCurrentPosition(function (position) {
        //             console.log("GOT POSTIION", position);
        //             // if(!position.coords.latitude && !position.coords.longitude){
        //             pos = {}
        //             // }else {
        //             //   pos = {lat: position.coords.latitude, lng: position.coords.longitude};
        //             // }

        //             // pos = {lat: position.coords.latitude, lng: position.coords.longitude};
        //             call_modal_radius_maps(pos, updategpslocation_radius, showError);
        //         });
        //         return;
        //     }
        // }



    }
    

    function updategpslocation(loc) {
        var data = {
            shopid: tempbranch.shopid,
            _id: tempbranch._id
        };
        data.location = {type: "Point", coordinates: [loc.lat, loc.lng]};

        $.postJSON('/api/data/kinarai/shop_branch_edit', data, function (res) {
            if (!res.result) {
                alert(res.detail);
                return;
            }
            tempbranch.location = data.location;
            $('#writelocationok').show('slow').hide('slow');
        });
    }
    
        function showError(error) {
        console.log("ERROR", error)
    }
  
</script>